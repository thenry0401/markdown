# 02. 배포하기 (AWS EC2 부분)

### 인스턴스 생성
- AWS 홈페이지에서 **EC2** 페이지로 들어간다

- 인스턴스 생성을 시작한다

- **Amazon Machine Image(AMI) 선택** 단계에서 **Ubuntu Server 16.04 LTS (HVM), SSD Volume Type** 를 선택한다

- **인스턴스 유형 선택** 단계에서는 프리티어에서 사용 가능한 것 한게 있으므로 그것을 선택한다

- 선택 후 다음 단계로 넘어갈 필요 없이 **검토 및 시작**을 해도된다

- **인스턴스 시작 검토** 단계에서 시작 버튼을 누르면 **키 페어** 관련 창이 나온다

	- 내가 만든 인스턴스에 나만 접속할 수 있게 SSH키를 만드는 것이다
	
	- 새로 키 페어를 생성한후 다운로드한다. 이 키 페어는 이때 한번 만 다운할 수 있다
	
	- 다운받은 키페어 파일을 ` ~/.ssh ` 폴더 안에 넣는다
	
- 이제 마지막으로 시작 버튼을 누른다

- 그 후 인스턴스 보기를 누르면 만들어진 인스턴스를 확인 할 수 있다

	- 인스턴스 이름을 DeployEC2로 바꿔준다
	
	- 완전히 사용할 수 있는 상태가 될때까지 몇분 소요된다
	
- 인스턴스 확인할 수 있는 창 밑부분에 **퍼블릭 DNS**라는 것이 주소이다. 이 주소로 인스턴스에 접속한다

---

### ssh 명령어를 통해 인스턴스에 접속

```
>>> / ssh -i <키페어 파일 경로> <유저이름>@<퍼블릭 DNS 주소>
```

명령어가 길기 때문에 zshrc에 alias로 저장하는게 좋다

```
(~/.zshrc)

alias con-ec2="명령어"
```

- 위 명령어 입력시 *UNPROTECTED PRIVATE KEY FILE* 에러 발생 가능

```
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
```

- 키 페어가 누구나 접근이 가능한 상태일 때 발생한다. 명령어로 나만이 접근 가능하도록 권한을 바꿔준다

```
chmod 400 <키페어 파일>

(`-rw-rw-r--` 에서 `-r--------` 로 바뀐다)
```

---

### AWS CLI(명령줄 인터페이스)

- AWS 홈페이지에서 마우스로 클릭하면서 만드는 대신에 커맨드 라인에서 명령어로 쉽게 인스턴스를 만들수 있다

- 적용할 프로젝트 폴더 가상환경 내에서 `pip install awslci` 로 설치해준다

- 먼저 aws configure를 설정해야 하는데 그 전에 **AWS IAM**에서 사용자를 생성해줍니다

	- **IAM**이란? AWS 계정을 처음 생성하면, AWS 서비스 전체에 대해 모두 접근 권한을 가진 유저(루트 유저)로 시작한다. 이 문제를 방지하기 위해 **IAM**에서 필요한 서비스에 대해서만 접근 가능하게 하는 유저를 만들어서 사용할 수 있다 
	
- **IAM** 페이지에서 새로 사용자를 추가합니다 사용자 이름은 EC2-User로 한다

- **AWS 액세스 유형 선택** 

	- **프로그래밍 방식 액세스** : CLI 환경에서 사용하는 방식이다
	
	- **AWS Management Console 액세스** : AWS 콘솔 페이지에서 사용하는 방식이다
	
> 두가지 다 선택할 수 도 있다 여기서는 **프로그래밍 방식 액세스**를 선택한다

- 다음 페이지는 **EC2-User 에 대한 암호 설정** 단계이다

- 권한을 주기위해 **기존 정책 직접 연결**을 누른다

- EC2를 사용할것이기 때문에 **EC2FullAccess**를 선택한다

- 사용자가 생성되면 **액세스 키 ID**와 **비밀 액세스 키**가 나온다

	- 비밀 액세스 키는 이 화면이 꺼지면 다시 볼수 없기때문에 다운로드 하는것도 좋다
	
- 이제 AWS configure 설정을 한다

```
>>> aws configure

AWS Access Key ID [None]: <생성한 액세스 키 ID>
AWS Secret Access Key [None]: <생성한 비밀 액세스 키>
Default region name [None]: ap-northeast-2
Default output format [None]: json
```
> 잘못 작성했을 경우 ` ~/.aws ` 폴더에서 config 파일과 credentials 파일을 확인하면 된다



